import React from 'react';
import { GameState, Player, Cell as CellType } from '../types/game';
import Board from '../components/Board';
import PlayerInfo from '../components/PlayerInfo';
import Timer from '../components/Timer';
import '../styles/GamePage.css';

interface GamePageProps {
  gameState: GameState;
  playerId: string;
  onReveal: (row: number, col: number) => void;
  onFlag: (row: number, col: number) => void;
}

const GamePage: React.FC<GamePageProps> = ({ gameState, playerId, onReveal, onFlag }) => {
  const myPlayerIndex = gameState.players.findIndex(p => p.id === playerId);
  const myPlayer = gameState.players[myPlayerIndex];
  const opponentPlayer = gameState.players.find(p => p.id !== playerId);

  if (!myPlayer) return <div>Loading...</div>;

  return (
    <div className="game-page">
      <div className="game-header">
        <div className="game-info">
          <Timer start={gameState.timerStart} end={gameState.timerEnd} />
          <div className="room-info">Room: {gameState.roomId}</div>
        </div>
      </div>

      <div className="game-container">
        <div className="player-section my-section">
          <PlayerInfo player={myPlayer} />
          <div className="board-wrapper">
            <Board
              grid={myPlayer.gridState}
              onCellClick={onReveal}
              onCellRightClick={onFlag}
              readOnly={myPlayer.gameOver || gameState.status === 'ended'}
            />
          </div>
        </div>

        <div className="separator">VS</div>

        <div className="player-section opponent-section">
          {opponentPlayer ? (
            <>
              <PlayerInfo player={opponentPlayer} />
              <div className="board-wrapper">
                <Board
                  grid={opponentPlayer.gridState}
                  readOnly={true}
                />
              </div>
            </>
          ) : (
            <div className="waiting-opponent">Waiting for opponent...</div>
          )}
        </div>
      </div>
      
      {gameState.status === 'ended' && (
        <div className="game-result-overlay">
          <div className="result-box">
             <h2>Game Over</h2>
             {gameState.winnerId === playerId ? (
               <div className="winner">You Won! <img src="/assets/trophy.svg" alt="Trophy" width="32" /></div>
             ) : gameState.draw ? (
               <div className="draw">Draw!</div>
             ) : (
               <div className="loser">You Lost</div>
             )}
             <button onClick={() => window.location.reload()}>Play Again</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default GamePage;
